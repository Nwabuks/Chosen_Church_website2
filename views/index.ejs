<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1200, initial-scale=1.0, user-scalable=yes">
    <title>Chibooks | Homepage</title>
    <!-- SVG Favicons -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/svg+xml" sizes="16x16" href="/favicon-16x16.svg">
    <link rel="icon" type="image/svg+xml" sizes="32x32" href="/favicon-32x32.svg">
    <link rel="icon" type="image/svg+xml" sizes="64x64" href="/favicon-64x64.svg">
    <link rel="apple-touch-icon" type="image/svg+xml" sizes="180x180" href="/apple-touch-icon.svg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <img src="/images/church-logo.png" alt="Church Logo" class="logo-image">
                    <h1>The God of Chosen Answers Prayers</h1>
                </div>
                <div class="mobile-menu">
                    <i class="fas fa-bars"></i>
                </div>
                <nav>
                    <ul>
                        <li><a href="/" class="active">Home</a></li>
                        <li><a href="/messages">Messages</a></li>
                        <li><a href="#" class="blurred">Testimonies</a></li>
                        <li><a href="#" class="blurred">Events/News</a></li>
                        <li><a href="#" class="blurred">About</a></li>
                        <li><a href="/admin-login">Admin</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h2>Welcome to Our Church</h2>
            <p>Experience the power of prayer and the joy of fellowship. Join us as we worship and grow in faith together.</p>
            <a href="/messages" class="btn">View All Messages</a>
        </div>
    </section>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
<!-- Announcements Section -->
<div class="announcements-section">
  <h2 class="section-title">Latest Announcements</h2>
  <div class="announcements-grid">
    <% if (announcements && announcements.length > 0) { %>
      <% announcements.forEach(function(announcement) { %>
        <div class="announcement-card priority-border-<%= announcement.priority %>" style="background: <%= announcement.backgroundColor %>; color: <%= announcement.textColor %>;">
          <!-- Add the priority circle at the top right -->
          <div class="priority-circle priority-<%= announcement.priority %>"></div>
          
          <div class="announcement-image-container">
            <% if (announcement.imageFile && announcement.imageFile.data) { %>
              <img src="/announcement-image/<%= announcement._id %>" alt="<%= announcement.title %>">
            <% } else { %>
              <div class="no-image-placeholder" style="height: 100%; display: flex; align-items: center; justify-content: center; background: #f8f9fa;">
                <i class="fas fa-image fa-3x text-muted"></i>
              </div>
            <% } %>
          </div>
          <div class="announcement-content">
            <div class="announcement-header">
              <h3 class="announcement-title" style="color: <%= announcement.textColor %>;"><%= announcement.title %></h3>
              <% if (announcement.featured) { %>
                <span class="announcement-badge badge-featured"><i class="fas fa-star"></i> Featured</span>
              <% } %>
            </div>
            <p class="announcement-text" style="color: <%= announcement.textColor %>;"><%= announcement.content %></p>
            <div class="announcement-footer">
              <span class="announcement-date" style="color: <%= announcement.textColor %>;">
                <i class="far fa-calendar-alt"></i> 
                <%= new Date(announcement.createdAt).toLocaleDateString() %>
              </span>
              <span class="announcement-status status-<%= announcement.active ? 'active' : 'inactive' %>">
                <%= announcement.active ? 'Active' : 'Inactive' %>
              </span>
            </div>
          </div>
        </div>
      <% }); %>
    <% } else { %>
      <div class="no-announcements">
        <p>No announcements available at this time.</p>
      </div>
    <% } %>
  </div>
</div>
            <!-- Events Section -->
            <section class="events-section">
                <h2 class="section-title">Church Events & News</h2>
                
                <% 
                // Function to generate event card HTML
                function generateEventCard(event, isFeatured) {
                    const eventDate = new Date(event.date);
                    const endDate = event.endDate ? new Date(event.endDate) : null;
                    
                    // Format date display
                    let dateDisplay = '';
                    if (endDate) {
                        // Multi-day event date range
                        dateDisplay = eventDate.toLocaleDateString('en-US', { 
                            month: 'short', 
                            day: 'numeric'
                        }) + ' - ' + endDate.toLocaleDateString('en-US', { 
                            month: 'short', 
                            day: 'numeric',
                            year: 'numeric'
                        });
                    } else {
                        // Single-day event
                        dateDisplay = eventDate.toLocaleDateString('en-US', { 
                            month: 'short', 
                            day: 'numeric',
                            year: 'numeric'
                        });
                    }
                    
                    // Determine status text
                    let statusText = '';
                    if (event.status === 'upcoming') statusText = 'Upcoming';
                    else if (event.status === 'ongoing') statusText = 'ðŸ”¥ Ongoing';
                    else if (event.status === 'completed') statusText = 'Past Event';
                    
                    return `
                    <div class="event-card ${event.status} ${isFeatured ? 'featured' : ''}">
                        <!-- Image on the left -->
                        <div class="event-image-container">
                            <img src="/event-image/${event._id}" alt="${event.title}" class="event-image">
                        </div>
                        
                        <!-- Event details on the right -->
                        <div class="event-content">
                            <div>
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <span class="event-date">
                                        <i class="far fa-calendar"></i> ${dateDisplay}
                                    </span>
                                    <div class="event-badges">
                                        ${isFeatured ? '<span class="event-featured">Featured</span>' : ''}
                                        <span class="event-status-badge event-status-${event.status}">
                                            ${statusText}
                                        </span>
                                    </div>
                                </div>
                                
                                <h3 class="event-title">${event.title}</h3>
                                
                                <div class="event-venue">
                                    <i class="fas fa-map-marker-alt"></i>
                                    <span>${event.venue}</span>
                                </div>
                                
                                <p class="event-description">${event.description}</p>
                                
                                <!-- Show time for single-day events -->
                                ${!endDate ? `
                                <div class="event-time">
                                    <i class="far fa-clock"></i>
                                    <span>${eventDate.toLocaleTimeString('en-US', { 
                                        hour: 'numeric', 
                                        minute: '2-digit',
                                        hour12: true 
                                    })}</span>
                                </div>
                                ` : ''}
                            </div>
                            
                            <!-- Event actions based on status -->
                            <div class="event-actions">
                                ${event.status === 'upcoming' && event.link ? `
                                    <a href="${event.link}" target="_blank" class="btn btn-small">
                                        <i class="fas fa-external-link-alt"></i> Register Now
                                    </a>
                                ` : ''}
                                ${event.status === 'ongoing' && event.link ? `
                                    <a href="${event.link}" target="_blank" class="btn btn-small btn-warning">
                                        <i class="fas fa-video"></i> Join Live Now
                                    </a>
                                ` : ''}
                                ${event.status === 'completed' ? `
                                    <button class="btn btn-small btn-outline" onclick="shareEvent('${event.title}', '${event.link || ''}')">
                                        <i class="fas fa-share-alt"></i> Share
                                    </button>
                                ` : ''}
                                
                                ${event.link && event.status !== 'completed' ? `
                                    <a href="${event.link}" target="_blank" class="btn btn-small btn-outline">
                                        <i class="fas fa-info-circle"></i> Details
                                    </a>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                    `;
                }
                
                if (featuredEvents && featuredEvents.length > 0) { 
                    // Sort events: featured first, then by date (upcoming first)
                    const sortedEvents = [...featuredEvents].sort((a, b) => {
                        // Featured events first
                        if (a.featured && !b.featured) return -1;
                        if (!a.featured && b.featured) return 1;
                        
                        // Then by date (upcoming first)
                        const dateA = new Date(a.date);
                        const dateB = new Date(b.date);
                        const now = new Date();
                        
                        // Both upcoming: sort by date (sooner first)
                        if (dateA > now && dateB > now) {
                            return dateA - dateB;
                        }
                        // One upcoming, one past: upcoming first
                        if (dateA > now && dateB <= now) return -1;
                        if (dateA <= now && dateB > now) return 1;
                        
                        // Both past: sort by date (most recent first)
                        return dateB - dateA;
                    });
                    
                    // Separate featured and regular events
                    const featured = sortedEvents.filter(e => e.featured);
                    const regular = sortedEvents.filter(e => !e.featured);
                %>
                    
                    <!-- Featured Events Section -->
                    <% if (featured.length > 0) { %>
                        <div class="featured-events-section mb-4">
                            <h3 class="text-warning mb-3">
                                <i class="fas fa-star"></i> Featured Events
                            </h3>
                            <div class="events-grid">
                                <% featured.forEach(function(event) { %>
                                    <%- generateEventCard(event, true) %>
                                <% }); %>
                            </div>
                        </div>
                    <% } %>
                    
                    <!-- Regular Events Section -->
                    <% if (regular.length > 0) { %>
                        <div class="regular-events-section">
                            <% if (featured.length > 0) { %>
                                <h3 class="text-primary mb-3">
                                    <i class="fas fa-calendar-alt"></i> All Events
                                </h3>
                            <% } %>
                            <div class="events-grid">
                                <% regular.forEach(function(event) { %>
                                    <%- generateEventCard(event, false) %>
                                <% }); %>
                            </div>
                        </div>
                    <% } %>
                    
                    <!-- Show event count with ongoing events highlighted -->
                    <div class="alert alert-info mt-4">
                        <i class="fas fa-info-circle"></i> 
                        Showing <%= sortedEvents.length %> events 
                        (<%= sortedEvents.filter(e => e.status === 'upcoming').length %> upcoming, 
                         <%= sortedEvents.filter(e => e.status === 'ongoing').length %> ongoing,
                         <%= sortedEvents.filter(e => e.status === 'completed').length %> past)
                        <% if (featured.length > 0) { %>
                            â€¢ <span class="text-warning"><i class="fas fa-star"></i> <%= featured.length %> featured</span>
                        <% } %>
                    </div>
                    
                <% } else { %>
                    <div class="no-events">
                        <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
                        <h4>No Events Scheduled</h4>
                        <p class="text-muted">Check back later for upcoming events and programs.</p>
                        <% if (isAdmin) { %>
                            <a href="/admin-events" class="btn btn-primary">
                                <i class="fas fa-plus-circle"></i> Add Events
                            </a>
                        <% } %>
                    </div>
                <% } %>
            </section>

            <!-- Vision and Mandate Section -->
            <section id="vision-mandate" class="vision-section">
                <h2 class="section-title">Our Vision & Mandate</h2>
                
                <div class="vision-grid">
                    <!-- Vision 1 -->
                    <div class="vision-card">
                        <div class="vision-icon">
                            <i class="fas fa-globe-americas"></i>
                        </div>
                        <h3>Grassroots Revival Worldwide</h3>
                        <p>To bring revival at the grassroots level across the world â€” street to street, village to village, city to city, nation to nation â€” turning people back to God through holiness and righteousness.</p>
                        <div class="bible-verse">
                            <i class="fas fa-bible"></i> Mark 16:15-17 â€¢ Matthew 24:14
                        </div>
                    </div>

                    <!-- Vision 2 -->
                    <div class="vision-card">
                        <div class="vision-icon">
                            <i class="fas fa-fire"></i>
                        </div>
                        <h3>Revival of Apostolic Christian Experiences</h3>
                        <p>To restore the old-time apostolic power as seen in the Book of Acts â€” genuine miracles, deliverances, salvation, and Holy Ghost manifestations.</p>
                        <div class="bible-verse">
                            <i class="fas fa-bible"></i> Acts 2:17 â€¢ Ephesians 4:11-13
                        </div>
                    </div>

                    <!-- Vision 3 -->
                    <div class="vision-card">
                        <div class="vision-icon">
                            <i class="fas fa-cloud"></i>
                        </div>
                        <h3>Rise of Heaven-Conscious Believers</h3>
                        <p>To prepare believers for the coming of Jesus Christ by raising a people who live with heaven-mindedness, holiness, and fear of God.</p>
                        <div class="bible-verse">
                            <i class="fas fa-bible"></i> Matthew 6:33 â€¢ John 14:1-3
                        </div>
                    </div>

                    <!-- The Mandate -->
                    <div class="mandate-card">
                        <div class="mandate-icon">
                            <i class="fas fa-cross"></i>
                        </div>
                        <h3>The 10 Billion Souls Mandate</h3>
                        <p>To win 10 billion souls worldwide for Christ â€” symbolic of a global evangelism mission reaching every nation, tribe, and tongue with the Gospel of Jesus Christ.</p>
                        <div class="bible-verse">
                            <i class="fas fa-bible"></i> Matthew 28:19-20
                        </div>
                        <div class="mandate-badge">Global Mission</div>
                    </div>
                </div>

                <!-- Motto and Holiness -->
                <div class="motto-holiness">
                    <div class="motto-card">
                        <h4><i class="fas fa-quote-left"></i> Our Motto</h4>
                        <p class="motto-text">"Heaven at Last."</p>
                    </div>
                    
                    <div class="holiness-card">
                        <h4><i class="fas fa-dove"></i> Our Emphasis</h4>
                        <p><strong>Holiness:</strong> The ministry strongly emphasizes holiness inside and outside, evangelism, and separation from sin.</p>
                        <ul>
                            <li>Holiness in heart and conduct</li>
                            <li>Powerful evangelism and soul-winning</li>
                            <li>Separation from worldly practices</li>
                            <li>Living in the fear of God</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Ministries Section -->
            <h2 class="section-title">Our Ministries</h2>
            <div class="features">
                <!-- Messages Card -->
                <div class="feature-card">
                    <i class="fas fa-book-open"></i>
                    <h3>Messages</h3>
                    <p>Access sermons and spiritual resources to strengthen your faith journey.</p>
                    <a href="/messages" class="btn btn-small">View All Messages</a>
                </div>

                <!-- Testimonies Card (Blurred) -->
                <div class="feature-card blurred">
                    <i class="fas fa-video"></i>
                    <h3>Testimonies</h3>
                    <p>Watch inspiring testimonies of God's work in people's lives.</p>
                    <a href="#" class="btn btn-small">View Testimonies</a>
                </div>

                <!-- Events/News Card (Blurred) -->
                <div class="feature-card blurred">
                    <i class="fas fa-calendar-alt"></i>
                    <h3>Events/News</h3>
                    <p>Stay updated with our church events, programs and news.</p>
                    <a href="#" class="btn btn-small">View Events</a>
                </div>

                <!-- About Card (Blurred) -->
                <div class="feature-card blurred">
                    <i class="fas fa-info-circle"></i>
                    <h3>About</h3>
                    <p>Learn more about our church, beliefs, and leadership.</p>
                    <a href="#" class="btn btn-small">Learn More</a>
                </div>
            </div>

            <!-- Messages Section -->
            <div id="messages-section">
                <h2 class="section-title">Recent Messages</h2>
                
                <!-- Show total message count -->
                <div class="alert alert-info mb-4">
                    <i class="fas fa-info-circle"></i> 
                    Showing <%= messages.length %> recent messages. 
                    <a href="/messages" class="alert-link">View all <%= totalMessages %> messages</a>
                </div>
                
                <% if (messages.length === 0) { %>
                    <div class="alert alert-warning">
                        <i class="fas fa-info-circle"></i> No messages available yet. 
                        Please check back later for new messages.
                    </div>
                <% } else { %>
                    <div class="messages-grid">
                        <% messages.forEach(function(message) { %>
                        <div class="message-card">
                            <div class="message-header">
                                <h3><%= message.title %></h3>
                                <span class="message-code"><%= message.code %></span>
                            </div>
                            <div class="message-body">
                                <div class="message-meta">
                                    <span><i class="far fa-calendar"></i> 
                                        <%= message.date.toLocaleDateString('en-US', { 
                                            year: 'numeric', 
                                            month: 'long', 
                                            day: 'numeric' 
                                        }) %>
                                    </span>
                                    <span><i class="far fa-user"></i> <%= message.author %></span>
                                </div>
                                <p class="message-description"><%= message.description %></p>
                                <div class="message-actions">
                                    <% if (message.filePath || message.pdfFile) { %>
                                        <a href="/pdf/<%= message._id %>" class="btn btn-small" download>
                                            <i class="fas fa-download"></i> Download
                                        </a>
                                        <!-- Add Preview Button -->
                                        <a href="/preview/<%= message._id %>" class="btn btn-small btn-outline">
                                            <i class="fas fa-eye"></i> Preview
                                        </a>
                                    <% } else { %>
                                        <span class="text-muted">
                                            <i class="fas fa-file-pdf"></i> No PDF available
                                        </span>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                        <% }); %>
                    </div>

                    <!-- View All Messages Button -->
                    <% if (totalMessages > messages.length) { %>
                        <div class="text-center mt-4">
                            <a href="/messages" class="btn btn-primary btn-lg">
                                <i class="fas fa-book-open"></i> View All <%= totalMessages %> Messages
                            </a>
                        </div>
                    <% } %>
                <% } %>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>Contact Us</h3>
                    <ul>
                        <li><i class="fas fa-map-marker-alt"></i> The Chosen Estate, Amuwo Odofin, along Oshodi Apapa Express Way near Ijesha Bus Stop, Lagos, Nigeria</li>
                        <li><i class="fas fa-phone"></i> (123) 456-7890</li>
                        <li><i class="fas fa-envelope"></i> info@churchofchosen.com</li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="/">Home</a></li>
                        <li><a href="/messages">Messages</a></li>
                        <li><a href="#" class="blurred-link">Testimonies</a></li>
                        <li><a href="#" class="blurred-link">Events/News</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Weekly Services</h3>
                    <ul>
                        <li><strong>Sunday:</strong> Branch Services (1st & 3rd) - 8:00 AM</li>
                        <li><strong>Sunday:</strong> HQ Combined Service (2nd & Last) - 8:00 AM</li>
                        <li><strong>Monday:</strong> Workers & Leaders Vigil - 11:00 PM</li>
                        <li><strong>Tuesday:</strong> HQ Revival Hour - 8:00 AM & 5:00 PM</li>
                        <li><strong>Tuesday:</strong> Local Branches Revival - 5:00 PM</li>
                        <li><strong>Wednesday:</strong> New Convert Class - 5:00 PM</li>
                        <li><strong>Thursday:</strong> Deliverance & Counseling - 8:00 AM</li>
                        <li><strong>Friday:</strong> General Vigil - 10:00 PM</li>
                        <li><strong>Saturday:</strong> Workers' Meeting / Bible Study - 9:00 AM</li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Connect With Us</h3>
                    <ul>
                        <li><a href="#"><i class="fab fa-facebook"></i> Facebook</a></li>
                        <li><a href="#"><i class="fab fa-instagram"></i> Instagram</a></li>
                        <li><a href="#"><i class="fab fa-youtube"></i> YouTube</a></li>
                        <li><a href="#"><i class="fas fa-globe"></i> Official Website</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2023 The Lord's Chosen Charismatic Revival Ministries. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // Mobile menu toggle
        document.querySelector('.mobile-menu')?.addEventListener('click', function() {
            const nav = document.querySelector('nav ul');
            if (nav.style.display === 'flex') {
                nav.style.display = 'none';
                this.innerHTML = '<i class="fas fa-bars"></i>';
            } else {
                nav.style.display = 'flex';
                this.innerHTML = '<i class="fas fa-times"></i>';
            }
        });

        // Smooth scrolling
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                const href = this.getAttribute('href');
                if (href !== '#' && href !== '#!') {
                    e.preventDefault();
                    const targetElement = document.querySelector(href);
                    if (targetElement) {
                        window.scrollTo({
                            top: targetElement.offsetTop - 100,
                            behavior: 'smooth'
                        });
                    }
                }
            });
        });

        // Blurred section warning
        document.querySelectorAll('.blurred, .blurred-link').forEach(element => {
            element.addEventListener('click', function(e) {
                e.preventDefault();
                alert('This section is currently unavailable. Please check back later.');
            });
        });

        // Auto-hide alerts after 5 seconds
        setTimeout(() => {
            document.querySelectorAll('.alert').forEach(alert => {
                alert.style.opacity = '0';
                alert.style.transition = 'opacity 0.5s';
                setTimeout(() => alert.remove(), 500);
            });
        }, 5000);

        // Responsive navigation
        function handleResize() {
            const nav = document.querySelector('nav ul');
            const mobileMenu = document.querySelector('.mobile-menu');
            if (window.innerWidth > 768) {
                nav.style.display = 'flex';
                mobileMenu.style.display = 'none';
            } else {
                nav.style.display = 'none';
                mobileMenu.style.display = 'block';
                mobileMenu.innerHTML = '<i class="fas fa-bars"></i>';
            }
        }
        window.addEventListener('resize', handleResize);
        handleResize(); // Initial check

        // Message card animations
        document.querySelectorAll('.message-card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-5px)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });

        // Event card animations
        document.querySelectorAll('.event-card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-5px)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });

        // Share event function
        function shareEvent(title, eventLink) {
            // Use event link if provided, otherwise use current page URL
            const shareUrl = eventLink || window.location.href;
            
            if (navigator.share) {
                navigator.share({
                    title: title,
                    url: shareUrl
                }).catch(err => {
                    console.log('Error sharing:', err);
                    // Fallback to clipboard
                    copyToClipboard(`${title} - ${shareUrl}`);
                });
            } else {
                // Fallback: copy to clipboard
                copyToClipboard(`${title} - ${shareUrl}`);
            }
        }

        // Clipboard function
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Event information copied to clipboard!');
            }).catch(err => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Event information copied to clipboard!');
            });
        }

        // Force desktop view on mobile
        function forceDesktopView() {
            if (window.innerWidth < 768) {
                document.body.style.minWidth = '1200px';
                document.body.style.overflowX = 'auto';
            }
        }

        window.addEventListener('load', forceDesktopView);
        window.addEventListener('resize', forceDesktopView);
    </script>
</body>
</html>
